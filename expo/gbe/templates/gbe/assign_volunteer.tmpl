{% extends 'base.tmpl' %}
{% load staticfiles %}

{% block title %}
   Review Bids
{% endblock %}

{% block content %}
<form action="{{ actionURL }}" method="post">
  
<div>
  <div>
    <h2>Assign Volunteer to Opportunities</h2>
    <h3><b>Volunteer:  </b> {{volunteer}}<br></h3>
    <p>
    <font color='red'>*</font> Using this form to assign the volunteer to
    opportunities will cause their bid state to change to 'Accepted'.  To
    remove the volunteer from scheduling and reject the bid, use the "Review"
    page and reject the bid there.</p>
  </div>
  <div>
    Toggle column(s):
    <a class="toggle-vis" data-column="1">
	Window</a> -
      <a class="toggle-vis" data-column="2">
	Pref</a> -
      <a class="toggle-vis" data-column="3">
	Event</a> -
      <a class="toggle-vis" data-column="4">
	Start</a> -
      <a class="toggle-vis" data-column="5">
	End</a> -
      <a class="toggle-vis" data-column="6">
	Parent</a> -
      <a class="toggle-vis" data-column="7">
	Have</a> -
      <a class="toggle-vis" data-column="8">
	Need</a> -
      <a class="toggle-vis" data-column="9">
	Full</a> -
  </div>
  <div>
    {% csrf_token %}
    <table id="assign_volunteer" class="order-column" cellspacing="0" width="100%">
      <thead>
        <tr class="bid-table">
            <th class="bid-table">&nbsp;</th>
            <th class="bid-table">Window</th>
            <th class="bid-table">Prefer</th>
            <th class="bid-table">Event</th>
            <th class="bid-table">Start</th>
            <th class="bid-table">End</th>
            <th class="bid-table">Parent</th>
            <th class="bid-table">H</th>
            <th class="bid-table">N</th>
            <th class="bid-table">Full</th>
        </tr>
      </thead>
      <tfoot>
        <tr class="bid-table">
            <th class="bid-table">&nbsp;</th>
            <th class="bid-table">Window</th>
            <th class="bid-table">Prefer</th>
            <th class="bid-table">Event</th>
            <th class="bid-table">Start</th>
            <th class="bid-table">End</th>
            <th class="bid-table">Parent</th>
            <th class="bid-table">H</th>
            <th class="bid-table">N</th>
            <th class="bid-table">Full</th>
        </tr>
      </tfoot>
      <tbody>
        {% for event_window in volunteer_event_windows %}
        <tr class="bid-table">
            <td class="bid-table">
              <input id="id_events_{{ forloop.counter0 }}"
                name="events" type="checkbox" value="{{event_window.event.pk}}"
                {% if event_window.event in bookings %}checked="checked"{% endif %}/>
            </td>
            <td class="bid-table">
              {{event_window.window.start_datetime}} - {{event_window.window.end_datetime}}
            </td>
            <td class="bid-table">
              {% if event_window.window in volunteer.available_windows.all%}
                Free<br>
              {% endif %}
              {% if event_window.window in volunteer.unavailable_windows.all%}
                Not Free<br>
              {% endif %}
            </td>
            <td class="bid-table">
<a href="{% url 'scheduler:detail_view' event_window.event.eventitem.eventitem_id%}">
                {{event_window.event}}
              </a></td>
            <td class="bid-table">{{event_window.event.start_time|date:"D, f A" }}</td>
            <td class="bid-table">{{event_window.event.end_time|date:"D, f A" }}</td>
            <td class="bid-table">
              {% if event_window.event.container_event.parent_event %}
<a href="{% url 'scheduler:detail_view' event_window.event.container_event.parent_event.eventitem.eventitem_id%}">
                {{event_window.event.container_event.parent_event}}
              </a>
              {% endif %}
            </td>
            <td class="bid-table">{{event_window.event.volunteer_count|cut:" volunteers"}}</td>
            <td class="bid-table">{{event_window.event.max_volunteer}}</td>
            <td class="bid-table">{% if event_window.event.max_volunteer = event.event.volunteer_count %}
              Y
              {%else%}
              N
            {% endif %}
            </td>
        </tr>
        {% endfor%}
      </tbody>
    </table>
    <br><br>
    <input type="submit" value="Submit Form"> 
  </div>
</div>
<script>
  $(document).ready(function() {
    var table = $('#assign_volunteer').DataTable( {
        "lengthMenu": [[10, 25, 50, -1], [10, 25, 50, "All"]]
    } );
 
    $('a.toggle-vis').on( 'click', function (e) {
        e.preventDefault();
 
        // Get the column API object
        var column = table.column( $(this).attr('data-column') );
 
        // Toggle the visibility
        column.visible( ! column.visible() );
    } );
} );
  </script>
</form>

{% endblock %}
